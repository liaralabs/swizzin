#!/usr/bin/env bash

export dbdir="/var/lib/swizzin/db"

# Get a value from the database
# \
# $1 = key
# \
# **Returns code 1 if not found**
getswizdb() {
    key="$1"
    cat "$(pathswizdb "$key")" >> "$log" 2>&1
}
export -f getswizdb

#Clear a value in the "database"
# \
# $1 = key
# \
# **Returns code 1 if not found**
clearswizdb() {
    key="$1"
    rm "$(pathswizdb "$key")" >> "$log" 2>&1
}
export -f clearswizdb

# Set a value in the database
# \
# $1 = key
# $2 = value
setswizdb() {
    mkdir -p $dbdir # Always ensure dir exists
    key="$1"
    value="$2"
    echo_log_only "Setting \"$key\" to \"$value\""
    echo "${value}" > "$dbdir/$key"
}
export -f setswizdb

# Returns the path of a key file from db
# \
# $1 = key
# \
# **Returns code 1 if not found**
pathswizdb() {
    key="$1"
    if [ -e "$dbdir/$key" ]; then
        echo "$dbdir/$key"
        return 0
    else
        echo_log_only "File for \"$key\" does not exist"
        return 1
    fi
}
export -f pathswizdb
